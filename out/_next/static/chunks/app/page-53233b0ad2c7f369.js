(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3799:function(){},3938:function(){},7124:function(e,n,t){Promise.resolve().then(t.bind(t,735))},735:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return u}});var s=t(9854),o=t(5837),i=t.n(o),c=t(3584),a=t.n(c),l=t(4821),r=t(7732);class d{getId(){return this.eventId++,r.Z.setItem(this.eventIdStoreKey,String(this.eventId)).catch(()=>{}),this.eventId}constructor(){this.eventIdStoreKey="ton-connect-service-event-id",this.eventId=0,r.Z.getItem(this.eventIdStoreKey).then(e=>{this.eventId=Number(e)}).catch(()=>{})}}let h=new d;class g{init(e){}genClientId(e){let n=new l.m6(null!=e?e:void 0),t=n.stringifyKeypair(),s=n.sessionId;return console.log("genClientId sessionKeyPair",t),{sessionKeyPair:t,sessionId:s}}async handleMessage(e){console.log("handleMessage",e);try{let{from:n,message:t}=JSON.parse(e.data);console.log("handleMessage",n),this.connection.to=n}catch(e){console.log("handleMessage error"),console.error(e)}}async send(e,n,t,s){try{let o="".concat(this.bridgeUrl,"/message?client_id=").concat(n.sessionId,"&to=").concat(t,"&ttl=").concat(s||this.defaultTtl),i=n.encrypt(JSON.stringify(e),(0,l.SW)(t));await fetch(o,{body:l.DS.encode(i),method:"POST"})}catch(e){console.log("send fail",e)}}async connect(){let{sessionKeyPair:e,sessionId:n}=this.genClientId(),t="".concat(this.bridgeUrl,"/events?client_id=").concat(n);this.eventSource=new(i())(t),this.eventSource.addEventListener("message",a()(this.handleMessage.bind(this),200)),this.eventSource.addEventListener("open",async()=>{this.connection.sessionKeyPair=e,console.log("sse connect: opened"),console.log(t);let s="v=2&id=".concat(encodeURIComponent(n),"&r=").concat(encodeURIComponent(JSON.stringify({manifestUrl:"https://app.ston.fi/tonconnect-manifest.json",items:[{name:"ton_addr"}]})),"&ret=none");console.log("search",s),console.log("link","".concat(this.deeplink,"?startapp=bgwconnect-").concat(s.replaceAll(".","%2E").replaceAll("-","%2D").replaceAll("_","%5F").replaceAll("&","-").replaceAll("=","__").replaceAll("%","--")))}),this.eventSource.addEventListener("error",e=>{console.log("sse connect: error",e)})}close(){this.eventSource&&(this.eventSource.removeAllEventListeners(),this.eventSource.close(),this.eventSource=null,console.log("sse close"))}signMessage(){let e=this.connection.to,n=this.connection,t=new l.m6(n.sessionKeyPair);this.send({id:h.getId(),event:"signMessage",chain:"",payload:"this is demo message."},t,e)}signTransaction(){let e=this.connection.to,n=this.connection,t=new l.m6(n.sessionKeyPair);this.send({id:h.getId(),event:"signTransaction",chain:"bnb",payload:'[{"data":"0x3593564c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000066f9115700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000100000000000000000000000000a90ff932b72727bf9f2ff42b2ba7034853888714000000000000000000000000000000000000000000000000016345785d8a000000000000000000000000000000000000000000000000000000a7b727e497660200000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002b55d398326f99059ff775485246999027b31979550001f40e09fabb73bd3ade0a17ecc321fd13a19e81ce82000000000000000000000000000000000000000000","from":"0xa90FF932b72727Bf9F2fF42B2bA7034853888714","gas":"0x28b40","to":"0x1A0A18AC4BECDDbd6389559687d1A73d8927E416","value":"0x0"}]'},t,e)}sendTransaction(){}constructor(e){this.defaultTtl=300,this.bridgeUrl="https://ton-connect-bridge-local.bgwapi.io/bridge",this.deeplink="https://t.me/MatzohBot/bgw_local_herbert",this.eventSource=null,this.connections=[],this.activeRequests={},this.connection={sessionKeyPair:{},to:""},this.init(e)}}var f=t(3901);function u(){let[e,n]=(0,f.useState)({});return(0,f.useEffect)(()=>{n(new g({menifestUrl:"https://<YOUR_APP_URL>/tonconnect-manifest.json"}))},[]),(0,s.jsxs)("div",{className:"grid grid-rows-[20px_1fr_20px] items-center justify-items-center min-h-screen p-8 pb-20 gap-16 sm:p-20 font-[family-name:var(--font-geist-sans)]",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{e.connect()},children:"connect"}),(0,s.jsx)("button",{type:"button",onClick:()=>{e.signMessage()},children:"signMessage"}),(0,s.jsx)("button",{type:"button",onClick:()=>{e.signTransaction()},children:"signTransaction"})]})}}},function(e){e.O(0,[220,610,481,744],function(){return e(e.s=7124)}),_N_E=e.O()}]);